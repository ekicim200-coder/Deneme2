<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Miner - Ultimate Master</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <style>
        :root { --neon-cyan: #00f3ff; --neon-gold: #ffd700; --neon-red: #ff3131; --bg-deep: #050508; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; outline: none; }
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Segoe UI', sans-serif; color: white; }

        /* LOADING SCREEN */
        #loadingScreen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #050508; z-index: 99999; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .loader { width: 50px; height: 50px; border: 5px solid #222; border-top: 5px solid var(--neon-cyan); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* GAME ELEMENTS */
        #gameCanvas { display: block; width: 100%; height: 100%; }
        .view-section { display: none; width: 100%; height: 100vh; position: absolute; top: 0; left: 0; overflow-y: auto; padding-bottom: 90px; z-index: 10; scroll-behavior: smooth; }
        .view-section.active { display: block; animation: fadeIn 0.4s ease; }
        
        .neon-card { background: rgba(15, 15, 25, 0.95); border: 1px solid rgba(0, 243, 255, 0.2); border-radius: 16px; padding: 20px; margin: 15px; box-shadow: 0 0 20px rgba(0, 243, 255, 0.05); }
        .neon-btn { background: rgba(0, 243, 255, 0.1); border: 1px solid var(--neon-cyan); color: var(--neon-cyan); padding: 12px; border-radius: 8px; font-weight: bold; width: 100%; cursor: pointer; margin-bottom: 10px; font-size: 14px; transition: 0.2s; }
        .neon-btn:active { transform: scale(0.98); background: var(--neon-cyan); color: #000; }
        .neon-btn.gold { border-color: var(--neon-gold); color: var(--neon-gold); }

        /* NAV BAR */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; height: 70px; background: rgba(0,0,0,0.95); border-top: 1px solid #333; display: flex; justify-content: space-around; align-items: center; z-index: 1000; backdrop-filter: blur(10px); }
        .nav-item { color: #666; font-size: 10px; font-weight: bold; display: flex; flex-direction: column; align-items: center; width: 20%; transition: 0.3s; }
        .nav-item.active { color: var(--neon-cyan); text-shadow: 0 0 10px var(--neon-cyan); transform: translateY(-3px); }
        .nav-item i { font-size: 20px; margin-bottom: 5px; }

        /* HUD & RANKING */
        #hud-top { position: absolute; top: 20px; left: 20px; z-index: 20; pointer-events: none; }
        .hud-pill { background: rgba(0,0,0,0.8); border-left: 3px solid var(--neon-cyan); padding: 6px 12px; border-radius: 4px; color: #fff; margin-bottom: 5px; display: flex; align-items: center; gap: 8px; font-size: 11px; font-family: monospace; }
        .rank-item { display: flex; align-items: center; padding: 12px; margin-bottom: 8px; border-radius: 8px; background: rgba(255,255,255,0.05); border-bottom: 1px solid #333; font-size: 13px; }

        /* GUIDE (ACCORDION) */
        .guide-container { border: 1px solid #333; border-radius: 10px; overflow: hidden; margin-top: 10px; }
        .guide-item { border-bottom: 1px solid #333; background: rgba(255,255,255,0.02); }
        .guide-header { padding: 15px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; font-size: 14px; color: #eee; font-weight: bold; }
        .guide-content { display: none; padding: 15px; background: rgba(0,0,0,0.5); color: #bbb; font-size: 13px; line-height: 1.6; }
        .guide-item.active .guide-content { display: block; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div id="loadingScreen">
        <div class="loader"></div>
        <h2 style="color:var(--neon-cyan); letter-spacing:3px;">NEON MINER</h2>
        <p id="statusText" style="color:#666; font-size:12px;">Telegram ID doÄŸrulanÄ±yor...</p>
        <div id="errorLog" style="color:var(--neon-red); font-size:10px; margin-top:20px; max-width:80%; text-align:center; display:none; background:rgba(255,0,0,0.1); padding:10px; border-radius:5px;"></div>
    </div>

    <div id="gameView" class="view-section active">
        <canvas id="gameCanvas"></canvas>
        <div id="hud-top"></div>
        <div id="startContainer" style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); text-align:center; z-index:50;">
            <div style="width:160px; height:160px; border:2px solid var(--neon-cyan); border-radius:50%; display:flex; justify-content:center; align-items:center; cursor:pointer; box-shadow:0 0 40px var(--neon-cyan);" onclick="startGame()">
                <h2 data-lang="start">BAÅžLAT</h2>
            </div>
            <p style="color:#aaa; margin-top:20px; font-size:12px;" data-lang="moveDesc">DOKUN VE BAÅžLA</p>
        </div>
        <div id="gameOverUI" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 85%; display: none; z-index: 60; text-align: center;">
            <div class="neon-card" style="border-color: var(--neon-red);">
                <h2 style="color: var(--neon-red);" data-lang="gameOver">SÄ°STEM Ã‡Ã–KTÃœ</h2>
                <div id="sessionStats" style="margin: 20px 0; color: #fff; text-align: left; font-family: monospace;"></div>
                <button class="neon-btn gold" onclick="watchAd()" data-lang="recover">KURTAR (2X)</button>
                <button class="neon-btn" onclick="goToWalletFromGame()" data-lang="goToWallet">CÃœZDANA GÄ°T</button>
            </div>
        </div>
    </div>

    <div id="walletView" class="view-section">
        <h2 style="text-align:center; color:var(--neon-cyan); margin-top:30px;" data-lang="navWallet">CÃœZDAN</h2>
        <div id="walletList"></div>
    </div>

    <div id="newsView" class="view-section">
        <h2 style="text-align:center; color:var(--neon-cyan); margin-top:30px;" data-lang="navNews">HABERLER</h2>
        <div class="neon-card" style="border-color:#0088cc;">
            <h3 style="color:#0088cc; margin:0;" data-lang="tgTitle">TOPLULUK</h3>
            <button class="neon-btn" style="border-color:#0088cc; margin-top:10px;" onclick="window.open('https://telegram.org')" data-lang="tgJoin">KATIL</button>
        </div>
        <div class="neon-card" style="border-color:var(--neon-gold);">
            <h3 style="color:var(--neon-gold); margin:0;" data-lang="guideTitle">KILAVUZ</h3>
            <div class="guide-container" id="guideContainer"></div>
        </div>
    </div>

    <div id="champView" class="view-section">
        <div style="text-align:center; padding: 20px;">
            <h2 style="color: var(--neon-gold); margin:0;" data-lang="navChamp">LÄ°G</h2>
            <div style="display:flex; background:rgba(255,255,255,0.1); border-radius:8px; margin-top:15px; padding:4px;">
                <button id="tabDaily" class="neon-btn active" style="margin:0; border:none; background:var(--neon-cyan); color:#000;" onclick="switchLbTab('daily')" data-lang="lbDaily">GÃœNLÃœK</button>
                <button id="tabRef" class="neon-btn" style="margin:0; border:none; background:transparent; color:#888;" onclick="switchLbTab('ref')" data-lang="lbRef">AYLIK</button>
            </div>
        </div>
        <div id="rankContainer" style="padding: 0 15px;"></div>
    </div>

    <div id="settingsView" class="view-section">
        <h2 style="text-align:center; color:var(--neon-cyan); margin-top:30px;" data-lang="navSettings">AYARLAR</h2>
        <div class="neon-card">
            <p style="color:#888; font-size:12px;" data-lang="langTitle">DÄ°L</p>
            <button class="neon-btn" onclick="openLangModal()"><span id="activeLangName">ðŸ‡¹ðŸ‡· TÃ¼rkÃ§e</span></button>
        </div>
        <div class="neon-card" style="border-color:var(--neon-gold);">
            <h3 style="color:var(--neon-gold); margin:0;" data-lang="refTitle">REFERANS</h3>
            <div style="display:flex; gap:10px; margin:15px 0;">
                <div style="flex:1; background:rgba(0,0,0,0.5); padding:10px; text-align:center; border-radius:8px;">
                    <div style="font-size:18px; color:var(--neon-gold);" id="totalRefs">0</div>
                    <div style="font-size:10px; color:#888;" data-lang="refMembers">ÃœYE</div>
                </div>
                <div style="flex:1; background:rgba(0,0,0,0.5); padding:10px; text-align:center; border-radius:8px;">
                    <div style="font-size:18px; color:var(--neon-gold);" id="totalComm">0</div>
                    <div style="font-size:10px; color:#888;" data-lang="refEarnings">KAZANÃ‡</div>
                </div>
            </div>
            <input type="text" id="myRefLink" class="neon-card" style="width:100%; margin:10px 0; background:#000; font-size:11px; padding:10px; color:var(--neon-gold);" readonly>
            <button class="neon-btn gold" onclick="copyRefLink()" id="copyBtn">LÄ°NKÄ° KOPYALA</button>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('game')" id="nav-game"><i class="fas fa-gamepad"></i><span data-lang="navGame">OYUN</span></div>
        <div class="nav-item" onclick="switchTab('news')" id="nav-news"><i class="fas fa-newspaper"></i><span data-lang="navNews">HABER</span></div>
        <div class="nav-item" onclick="switchTab('champ')" id="nav-champ"><i class="fas fa-trophy"></i><span data-lang="navChamp">LÄ°G</span></div>
        <div class="nav-item" onclick="switchTab('wallet')" id="nav-wallet"><i class="fas fa-wallet"></i><span data-lang="navWallet">CÃœZDAN</span></div>
        <div class="nav-item" onclick="switchTab('settings')" id="nav-settings"><i class="fas fa-cog"></i><span data-lang="navSettings">AYAR</span></div>
    </div>

    <div id="modalOverlay">
        <div style="background:#111; border:1px solid var(--neon-cyan); border-radius:20px; width:85%; max-height:80%; overflow-y:auto; padding:20px;">
            <h3 style="color:var(--neon-cyan); margin-top:0;" data-lang="langTitle">DÄ°L SEÃ‡Ä°MÄ°</h3>
            <div id="langList" class="lang-grid"></div>
        </div>
    </div>

<script>
    // --- FIREBASE CONFIG ---
    const firebaseConfig = {
      apiKey: "AIzaSyBqsuakQQOdm1NcWLjYyMTyiLpGmoBh7iA",
      authDomain: "faucet-game.firebaseapp.com",
      projectId: "faucet-game",
      storageBucket: "faucet-game.firebasestorage.app",
      messagingSenderId: "258577212321",
      appId: "1:258577212321:web:302ebdcc27568e9c9e21e0",
      measurementId: "G-DXE818SCVE"
    };

    const BOT_USERNAME = "faucetgamebot";
    let db, auth, telegramID = "demo_" + Math.floor(Math.random()*9999);
    let referrerID = null;
    let user = { balances:{BTC:0,ETH:0,USDT:0,TRX:0}, addresses:{BTC:'',ETH:'',USDT:'',TRX:''}, lang:'tr', referrals:[], totalComm:0, lbData: {daily:[], ref:[], lastUpdate:0} };

    // --- DICTIONARY (11 LANGUAGES) ---
    const i18n = {
        tr: { start:"BAÅžLAT", moveDesc:"DOKUN VE KEÅžFET", navGame:"OYUN", navNews:"HABER", navChamp:"LÄ°G", navWallet:"CÃœZDAN", navSettings:"AYAR", refTitle:"REFERANS", refDesc:"%30 Komisyon.", tgTitle:"TOPLULUK", tgJoin:"KATIL", guideTitle:"KILAVUZ", g1t:"Oyun", g1d:"ParmaÄŸÄ±nÄ± sÃ¼rÃ¼kle, coin topla.", g2t:"AyÄ±lar", g2d:"KÄ±rmÄ±zÄ± ayÄ±lardan kaÃ§!", g3t:"Ã‡ekim", g3d:"1M olunca Ã§ek.", g4t:"Ref", g4d:"%30 kazan.", refMembers:"ÃœYE", refEarnings:"KAZANÃ‡", gameOver:"SÄ°STEM Ã‡Ã–KTÃœ", recover:"KURTAR (2X)", goToWallet:"CÃœZDAN", langTitle:"DÄ°L", lbDaily:"GÃœNLÃœK", lbRef:"AYLIK", you:"SEN", withdraw:"Ã‡EKÄ°M", limit:"1M GEREKLÄ°", addrPlace:"Adres", sentMsg:"Talep AlÄ±ndÄ±!" },
        en: { start:"START", moveDesc:"TOUCH TO EXPLORE", navGame:"GAME", navNews:"NEWS", navChamp:"RANK", navWallet:"WALLET", navSettings:"SETTINGS", refTitle:"REFERRAL", refDesc:"30% Comm.", tgTitle:"COMMUNITY", tgJoin:"JOIN", guideTitle:"GUIDE", g1t:"Play", g1d:"Drag finger, collect coins.", g2t:"Bears", g2d:"Avoid red bears!", g3t:"Withdraw", g3d:"Withdraw at 1M.", g4t:"Ref", g4d:"Earn 30%.", refMembers:"MEMBERS", refEarnings:"EARNINGS", gameOver:"SYSTEM CRASH", recover:"RECOVER (2X)", goToWallet:"WALLET", langTitle:"LANGUAGE", lbDaily:"DAILY", lbRef:"MONTHLY", you:"YOU", withdraw:"WITHDRAW", limit:"1M REQ.", addrPlace:"Address", sentMsg:"Sent!" },
        de: { start:"START", moveDesc:"BERÃœHREN", navGame:"SPIEL", navNews:"NEWS", navChamp:"RANG", navWallet:"BÃ–RSE", navSettings:"SETTING", refTitle:"REFERENZ", refDesc:"30% Prov.", tgTitle:"GEMEINSCHAFT", tgJoin:"BEITRETEN", guideTitle:"ANLEITUNG", g1t:"Spiel", g1d:"Sammeln.", g2t:"BÃ¤ren", g2d:"Vermeiden!", g3t:"Auszahlung", g3d:"Ab 1M.", g4t:"Ref", g4d:"30% Gewinn.", refMembers:"MITGLIEDER", refEarnings:"GEWINN", gameOver:"ABSTURZ", recover:"RETTEN", goToWallet:"BÃ–RSE", langTitle:"SPRACHE", lbDaily:"TÃ„GLICH", lbRef:"MONAT", you:"DU", withdraw:"AUSZ.", limit:"1M NÃ–TIG", addrPlace:"Adresse", sentMsg:"Gesendet!" },
        es: { start:"INICIAR", moveDesc:"MUEVE", navGame:"JUEGO", navNews:"NOTICIAS", navChamp:"RANGO", navWallet:"CARTERA", navSettings:"AJUSTE", refTitle:"REFERIDOS", refDesc:"30% Com.", tgTitle:"COMUNIDAD", tgJoin:"UNIRSE", guideTitle:"GUÃA", g1t:"Juego", g1d:"Recoge.", g2t:"Osos", g2d:"Â¡Evita osos!", g3t:"Retiro", g3d:"1M mÃ­nimo.", g4t:"Ref", g4d:"Gana 30%.", refMembers:"MIEMBROS", refEarnings:"GANANCIAS", gameOver:"FALLO", recover:"RECOUP (2X)", goToWallet:"CARTERA", langTitle:"IDIOMA", lbDaily:"DIARIO", lbRef:"MENSUAL", you:"TÃš", withdraw:"RETIRAR", limit:"1M REQ.", addrPlace:"DirecciÃ³n", sentMsg:"Â¡Enviado!" },
        fr: { start:"DÃ‰MARRER", moveDesc:"BOUGEZ", navGame:"JEU", navNews:"ACTUS", navChamp:"RANG", navWallet:"WALLET", navSettings:"RÃ‰GLAGE", refTitle:"PARRAINAGE", refDesc:"30% Comm.", tgTitle:"COMMUNAUTÃ‰", tgJoin:"REJOINDRE", guideTitle:"GUIDE", g1t:"Jeu", g1d:"Collectez.", g2t:"Ours", g2d:"Ã‰vitez-les!", g3t:"Retrait", g3d:"1M requis.", g4t:"Ref", g4d:"Gagnez 30%.", refMembers:"MEMBRES", refEarnings:"GAINS", gameOver:"PANNE", recover:"RÃ‰CUPÃ‰RER", goToWallet:"WALLET", langTitle:"LANGUE", lbDaily:"JOUR", lbRef:"MOIS", you:"VOUS", withdraw:"RETIRER", limit:"1M REQUIS", addrPlace:"Adresse", sentMsg:"EnvoyÃ©!" },
        ru: { start:"Ð¡Ð¢ÐÐ Ð¢", moveDesc:"Ð”Ð’Ð˜Ð“ÐÐ™Ð¡Ð¯", navGame:"Ð˜Ð“Ð Ð", navNews:"ÐÐžÐ’ÐžÐ¡Ð¢Ð˜", navChamp:"Ð¢ÐžÐŸ", navWallet:"ÐšÐžÐ¨Ð•Ð›Ð•Ðš", navSettings:"ÐÐÐ¡Ð¢Ð ", refTitle:"Ð Ð•Ð¤Ð•Ð ÐÐ›", refDesc:"30% ÐºÐ¾Ð¼.", tgTitle:"Ð¡ÐžÐžÐ‘Ð©Ð•Ð¡Ð¢Ð’Ðž", tgJoin:"Ð’Ð¡Ð¢Ð£ÐŸÐ˜Ð¢Ð¬", guideTitle:"Ð“ÐÐ™Ð”", g1t:"Ð˜Ð³Ñ€Ð°", g1d:"Ð¡Ð¾Ð±Ð¸Ñ€Ð°Ð¹.", g2t:"ÐœÐµÐ´Ð²ÐµÐ´Ð¸", g2d:"Ð˜Ð·Ð±ÐµÐ³Ð°Ð¹!", g3t:"Ð’Ñ‹Ð²Ð¾Ð´", g3d:"ÐžÑ‚ 1Ðœ.", g4t:"Ð ÐµÑ„", g4d:"30% Ð´Ð¾Ñ…Ð¾Ð´.", refMembers:"Ð£Ð§ÐÐ¡Ð¢ÐÐ˜ÐšÐ˜", refEarnings:"Ð”ÐžÐ¥ÐžD", gameOver:"Ð¡Ð‘ÐžÐ™", recover:"Ð’ÐžÐ¡Ð¡Ð¢", goToWallet:"ÐšÐžÐ¨Ð•Ð›Ð•Ðš", langTitle:"Ð¯Ð—Ð«Ðš", lbDaily:"Ð”Ð•ÐÐ¬", lbRef:"ÐœÐ•Ð¡Ð¯Ð¦", you:"Ð’Ð«", withdraw:"Ð’Ð«Ð’ÐžÐ”", limit:"1Ðœ ÐÐ£Ð–ÐÐž", addrPlace:"ÐÐ´Ñ€ÐµÑ", sentMsg:"ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾!" },
        pt: { start:"INICIAR", moveDesc:"MOVA", navGame:"JOGO", navNews:"NOTÃCIAS", navChamp:"RANK", navWallet:"CARTEIRA", navSettings:"AJUSTE", refTitle:"REFERÃŠNCIA", refDesc:"30% Comm.", tgTitle:"COMUNIDADE", tgJoin:"ENTRAR", guideTitle:"GUIA", g1t:"Jogo", g1d:"Colete.", g2t:"Ursos", g2d:"Evite-os!", g3t:"Saque", g3d:"1M req.", g4t:"Ref", g4d:"Ganha 30%.", refMembers:"MEMBROS", refEarnings:"GANHOS", gameOver:"ERRO", recover:"RECUPERAR", goToWallet:"CARTERA", langTitle:"IDIOMA", lbDaily:"DIÃRIO", lbRef:"MENSAL", you:"VOCÃŠ", withdraw:"SACAR", limit:"1M REQ.", addrPlace:"EndereÃ§o", sentMsg:"Enviado!" },
        id: { start:"MULAI", moveDesc:"GERAK", navGame:"MAIN", navNews:"BERITA", navChamp:"RANK", navWallet:"DOMPET", navSettings:"SETTING", refTitle:"REFERRAL", refDesc:"30% Kom.", tgTitle:"KOMUNITAS", tgJoin:"GABUNG", guideTitle:"PANDUAN", g1t:"Main", g1d:"Kumpulkan.", g2t:"Beruang", g2d:"Hindari!", g3t:"Tarik", g3d:"1M req.", g4t:"Ref", g4d:"Dapat 30%.", refMembers:"ANGGOTA", refEarnings:"PENDAPATAN", gameOver:"ERROR", recover:"PULIHKAN", goToWallet:"DOMPET", langTitle:"BAHASA", lbDaily:"HARIAN", lbRef:"BULANAN", you:"ANDA", withdraw:"TARIK", limit:"BUTUH 1M", addrPlace:"Alamat", sentMsg:"Terkirim!" },
        ja: { start:"ã‚¹ã‚¿ãƒ¼ãƒˆ", moveDesc:"å‹•ã", navGame:"ã‚²ãƒ¼ãƒ ", navNews:"ãƒ‹ãƒ¥ãƒ¼ã‚¹", navChamp:"ãƒ©ãƒ³ã‚¯", navWallet:"è²¡å¸ƒ", navSettings:"è¨­å®š", refTitle:"ç´¹ä»‹", refDesc:"30%ç²å¾—.", tgTitle:"ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£", tgJoin:"å‚åŠ ", guideTitle:"ã‚¬ã‚¤ãƒ‰", g1t:"ãƒ—ãƒ¬ã‚¤", g1d:"é›†ã‚ã‚‹.", g2t:"ç†Š", g2d:"é¿ã‘ã‚‹!", g3t:"å‡ºé‡‘", g3d:"1Mã‹ã‚‰.", g4t:"ç´¹ä»‹", g4d:"30%ç¨¼ã.", refMembers:"ãƒ¡ãƒ³ãƒãƒ¼", refEarnings:"åŽç›Š", gameOver:"ã‚¨ãƒ©ãƒ¼", recover:"å›žå¾©", goToWallet:"è²¡å¸ƒ", langTitle:"è¨€èªž", lbDaily:"æ¯Žæ—¥", lbRef:"æ¯Žæœˆ", you:"ã‚ãªãŸ", withdraw:"å‡ºé‡‘", limit:"1Må¿…è¦", addrPlace:"ã‚¢ãƒ‰ãƒ¬ã‚¹", sentMsg:"é€ä¿¡!" },
        ko: { start:"ì‹œìž‘", moveDesc:"ì´ë™", navGame:"ê²Œìž„", navNews:"ë‰´ìŠ¤", navChamp:"ëž­í‚¹", navWallet:"ì§€ê°‘", navSettings:"ì„¤ì •", refTitle:"ì¶”ì²œ", refDesc:"30% íšë“.", tgTitle:"ì»¤ë®¤ë‹ˆí‹°", tgJoin:"ì°¸ì—¬", guideTitle:"ê°€ì´ë“œ", g1t:"ê²Œìž„", g1d:"ìˆ˜ì§‘.", g2t:"ê³°", g2d:"í”¼í•˜ê¸°!", g3t:"ì¶œê¸ˆ", g3d:"1M ë¶€í„°.", g4t:"ì¶”ì²œ", g4d:"30% ìˆ˜ìµ.", refMembers:"ë©¤ë²„", refEarnings:"ìˆ˜ìµ", gameOver:"ì˜¤ë¥˜", recover:"ë³µêµ¬", goToWallet:"ì§€ê°‘", langTitle:"ì–¸ì–´", lbDaily:"ë§¤ì¼", lbRef:"ë§¤ì›”", you:"ë‚˜", withdraw:"ì¶œê¸ˆ", limit:"1M í•„ìš”", addrPlace:"ì£¼ì†Œ", sentMsg:"ì „ì†¡!" },
        hi: { start:"à¤¶à¥à¤°à¥‚", moveDesc:"à¤¹à¤¿à¤²à¥‡à¤‚", navGame:"à¤–à¥‡à¤²", navNews:"à¤¸à¤®à¤¾à¤šà¤¾à¤°", navChamp:"à¤°à¥ˆà¤‚à¤•", navWallet:"à¤µà¥‰à¤²à¥‡à¤Ÿ", navSettings:"à¤¸à¥‡à¤Ÿà¤¿à¤‚à¤—", refTitle:"à¤°à¥‡à¤«à¤°à¤²", refDesc:"30% à¤•à¤®à¥€.", tgTitle:"à¤¸à¤®à¥à¤¦à¤¾à¤¯", tgJoin:"à¤œà¥à¤¡à¤¼à¥‡à¤‚", guideTitle:"à¤—à¤¾à¤‡à¤¡", g1t:"à¤–à¥‡à¤²", g1d:"à¤œà¤®à¤¾ à¤•à¤°à¥‡à¤‚.", g2t:"à¤­à¤¾à¤²à¥‚", g2d:"à¤¬à¤šà¥‡à¤‚!", g3t:"à¤¨à¤¿à¤•à¤¾à¤¸à¥€", g3d:"1M à¤†à¤µà¤¶à¥à¤¯à¤•.", g4t:"à¤°à¥‡à¤«à¤°à¤²", g4d:"30% à¤•à¤®à¤¾à¤à¤‚.", refMembers:"à¤¸à¤¦à¤¸à¥à¤¯", refEarnings:"à¤•à¤®à¤¾à¤ˆ", gameOver:"à¤•à¥à¤°à¥ˆà¤¶", recover:"à¤ªà¥à¤¨à¤°à¥à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤", goToWallet:"à¤µà¥‰à¤²à¥‡à¤Ÿ", langTitle:"à¤­à¤¾à¤·à¤¾", lbDaily:"à¤¦à¥ˆà¤¨à¤¿à¤•", lbRef:"à¤®à¤¾à¤¸à¤¿à¤•", you:"à¤†à¤ª", withdraw:"à¤¨à¤¿à¤•à¤¾à¤¸à¥€", limit:"1M à¤œà¤°à¥‚à¤°à¥€", addrPlace:"à¤ªà¤¤à¤¾", sentMsg:"à¤­à¥‡à¤œà¤¾!" }
    };
    const LANGUAGES=[{code:'tr',name:'TÃ¼rkÃ§e',flag:'ðŸ‡¹ðŸ‡·'},{code:'en',name:'English',flag:'ðŸ‡ºðŸ‡¸'},{code:'de',name:'Deutsch',flag:'ðŸ‡©ðŸ‡ª'},{code:'es',name:'EspaÃ±ol',flag:'ðŸ‡ªðŸ‡¸'},{code:'fr',name:'FranÃ§ais',flag:'ðŸ‡«ðŸ‡·'},{code:'ru',name:'Ð ÑƒÑÑÐºÐ¸Ð¹',flag:'ðŸ‡·ðŸ‡º'},{code:'pt',name:'PortuguÃªs',flag:'ðŸ‡µðŸ‡¹'},{code:'id',name:'Indonesia',flag:'ðŸ‡®ðŸ‡©'},{code:'ja',name:'æ—¥æœ¬èªž',flag:'ðŸ‡¯ðŸ‡µ'},{code:'ko',name:'í•œêµ­ì–´',flag:'ðŸ‡°ðŸ‡·'},{code:'hi',name:'à¤¹à¤¿à¤¨à¥à¤¦à¥€',flag:'ðŸ‡®ðŸ‡³'}];

    function t(key){ return (i18n[user.lang]||i18n.en)[key]||key; }

    // --- INITIALIZATION ---
    window.onload = function() {
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            auth = firebase.auth();
            const tg = window.Telegram.WebApp;
            tg.expand();

            if(tg.initDataUnsafe && tg.initDataUnsafe.user) {
                telegramID = tg.initDataUnsafe.user.id.toString();
                referrerID = tg.initDataUnsafe.start_param;
            }

            // AUTH & LOAD
            auth.signInAnonymously().then(() => {
                const userRef = db.collection('users').doc(telegramID);
                userRef.get().then(doc => {
                    if(doc.exists) {
                        user = {...user, ...doc.data()};
                        finishLoad();
                    } else {
                        if(referrerID && referrerID !== telegramID) {
                            giveReward(referrerID).then(() => { saveData(); finishLoad(); });
                        } else { saveData(); finishLoad(); }
                    }
                });
            }).catch(e => {
                document.getElementById('errorLog').style.display='block';
                document.getElementById('errorLog').innerText = "Auth Error: " + e.message;
            });
        } catch(e) { alert("Start Error: " + e.message); }
    };

    async function giveReward(refID) {
        try {
            const refRef = db.collection('users').doc(refID);
            await db.runTransaction(async (transaction) => {
                const doc = await transaction.get(refRef);
                if(!doc.exists) return;
                transaction.update(refRef, {
                    totalComm: firebase.firestore.FieldValue.increment(50000),
                    "balances.USDT": firebase.firestore.FieldValue.increment(50000),
                    referrals: firebase.firestore.FieldValue.arrayUnion(telegramID)
                });
            });
        } catch(e) { console.log("Ref Reward Error"); }
    }

    function finishLoad() {
        document.getElementById('loadingScreen').style.display='none';
        document.getElementById('myRefLink').value = `https://t.me/${BOT_USERNAME}/app?startapp=${telegramID}`;
        updateAllUI();
    }

    function saveData() { db.collection('users').doc(telegramID).set(user); }

    // --- UI UPDATES ---
    function updateAllUI() {
        document.querySelectorAll('[data-lang]').forEach(el => el.innerText = t(el.getAttribute('data-lang')));
        const langObj = LANGUAGES.find(x => x.code === user.lang);
        document.getElementById('activeLangName').innerText = langObj ? langObj.name : "TÃ¼rkÃ§e";
        renderWallet();
        renderGuide();
        updateHUD();
        document.getElementById('totalRefs').innerText = user.referrals.length;
        document.getElementById('totalComm').innerText = user.totalComm.toLocaleString();
    }

    function renderGuide() {
        const gc = document.getElementById('guideContainer'); gc.innerHTML = '';
        ['g1','g2','g3','g4'].forEach(key => {
            gc.innerHTML += `<div class="guide-item" onclick="this.classList.toggle('active')"><div class="guide-header"><span>${t(key+'t')}</span><i class="fas fa-chevron-down"></i></div><div class="guide-content">${t(key+'d')}</div></div>`;
        });
    }

    function renderWallet() {
        const l = document.getElementById('walletList'); l.innerHTML = '';
        COINS.forEach(c => {
            const cur = user.balances[c.id]; const limit = 1000000;
            let perc = (cur / limit) * 100; if(perc > 100) perc = 100;
            l.innerHTML += `
            <div class="neon-card" style="border-color:${c.color}">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h3 style="color:${c.color}; margin:0;">${c.id}</h3>
                    <span style="font-weight:bold;">${cur.toLocaleString()}</span>
                </div>
                <div style="height:8px; background:#222; border-radius:4px; margin:15px 0; overflow:hidden;">
                    <div style="height:100%; width:${perc}%; background:${c.color}; box-shadow: 0 0 10px ${c.color};"></div>
                </div>
                <input class="neon-input" value="${user.addresses[c.id]}" placeholder="${t('addrPlace')}" onchange="user.addresses['${c.id}']=this.value;saveData()" style="width:100%;">
                <button class="neon-btn" onclick="withdraw('${c.id}')" style="opacity:${perc>=100?1:0.5}">${perc>=100 ? t('withdraw') : t('limit')}</button>
            </div>`;
        });
    }

    // --- GAME ENGINE ---
    const IMG_SRCS = { BTC:'https://upload.wikimedia.org/wikipedia/commons/4/46/Bitcoin.svg', ETH:'https://upload.wikimedia.org/wikipedia/commons/0/05/Ethereum_logo_2014.svg', USDT:'https://cryptologos.cc/logos/tether-usdt-logo.png?v=025', TRX:'https://cryptologos.cc/logos/tron-trx-logo.png?v=025' };
    const COIN_IMGS = {}; for(let k in IMG_SRCS) { let i = new Image(); i.src = IMG_SRCS[k]; COIN_IMGS[k] = i; }
    const cvs = document.getElementById('gameCanvas'); const cx = cvs.getContext('2d');
    let W, H, isPlaying=false, player={x:0,y:0,trail:[]}, entities=[], bgStars=[], sessionEarn={BTC:0,ETH:0,USDT:0,TRX:0}, enemyInterval;
    const COINS=[{id:'BTC',color:'#f7931a'},{id:'ETH',color:'#627eea'},{id:'USDT',color:'#26a17b'},{id:'TRX',color:'#eb0029'}];

    function resize(){ W=window.innerWidth; H=window.innerHeight; cvs.width=W; cvs.height=H; bgStars=[]; for(let i=0;i<50;i++) bgStars.push({x:Math.random()*W,y:Math.random()*H,s:Math.random()*2,v:Math.random()*0.5}); }
    window.addEventListener('resize', resize); resize();

    function startGame() { document.getElementById('startContainer').style.display='none'; isPlaying=true; player.trail=[]; entities=[]; sessionEarn={BTC:0,ETH:0,USDT:0,TRX:0}; for(let i=0;i<6;i++) spawnEntity('coin'); clearInterval(enemyInterval); enemyInterval = setInterval(() => { if(isPlaying) spawnEntity('enemy'); }, 1500); loop(); }
    function spawnEntity(type) {
        if(type==='coin') { const c = COINS[Math.floor(Math.random()*COINS.length)]; entities.push({type:'coin', x:Math.random()*(W-20)+10, y:Math.random()*(H-20)+10, id:c.id, color:c.color, p:0}); }
        else { const s=Math.floor(Math.random()*4); let x,y,vx,vy; if(s===0){x=Math.random()*W;y=-30;vx=0;vy=3;}else if(s===1){x=W+30;y=Math.random()*H;vx=-3;vy=0;}else if(s===2){x=Math.random()*W;y=H+30;vx=0;vy=-3;}else{x=-30;y=Math.random()*H;vx=3;vy=0;} entities.push({type:'enemy',x,y,vx,vy}); }
    }
    function loop() {
        if(!isPlaying) return; cx.fillStyle='rgba(5,5,8,0.4)'; cx.fillRect(0,0,W,H);
        cx.fillStyle="white"; bgStars.forEach(s=>{ s.y+=s.v; if(s.y>H)s.y=0; cx.globalAlpha=0.2; cx.beginPath(); cx.arc(s.x,s.y,s.s,0,Math.PI*2); cx.fill(); }); cx.globalAlpha=1;
        player.trail.push({x:player.x,y:player.y}); if(player.trail.length>15) player.trail.shift();
        cx.beginPath(); cx.strokeStyle="rgba(0,243,255,0.4)"; cx.lineWidth=3; for(let i=0;i<player.trail.length-1;i++) { cx.moveTo(player.trail[i].x,player.trail[i].y); cx.lineTo(player.trail[i+1].x,player.trail[i+1].y); } cx.stroke();
        cx.shadowBlur=15; cx.shadowColor=var(--neon-cyan); cx.fillStyle='#fff'; cx.beginPath(); cx.arc(player.x,player.y,10,0,Math.PI*2); cx.fill(); cx.shadowBlur=0;
        entities.forEach((e,i)=>{
            if(e.type==='coin'){
                e.p+=0.1; let r=14+Math.sin(e.p)*2; let img=COIN_IMGS[e.id];
                if(img.complete) cx.drawImage(img, e.x-r, e.y-r, r*2, r*2); else { cx.fillStyle=e.color; cx.beginPath(); cx.arc(e.x,e.y,r,0,Math.PI*2); cx.fill(); }
                if(Math.hypot(player.x-e.x,player.y-e.y)<30){ user.balances[e.id]+=1000; sessionEarn[e.id]+=1000; entities.splice(i,1); spawnEntity('coin'); updateHUD(); saveData(); }
            } else { e.x+=e.vx; e.y+=e.vy; cx.font="25px Arial"; cx.fillText("ðŸ»", e.x-12, e.y+10); if(Math.hypot(player.x-e.x,player.y-e.y)<25) gameOver(); if(e.x<-50||e.x>W+50||e.y<-50||e.y>H+50) entities.splice(i,1); }
        }); requestAnimationFrame(loop);
    }
    cvs.addEventListener('touchmove', e => { e.preventDefault(); player.x=e.touches[0].clientX; player.y=e.touches[0].clientY; }, {passive:false});
    function gameOver() { isPlaying=false; clearInterval(enemyInterval); document.getElementById('gameOverUI').style.display='block'; let h=''; for(let k in sessionEarn) if(sessionEarn[k]>0) h+=`<div style='display:flex;justify-content:space-between;padding:5px;'><span>${k}</span><span>+${sessionEarn[k]}</span></div>`; document.getElementById('sessionStats').innerHTML=h||"0"; saveData(); }

    // --- OTHER UI LOGIC ---
    window.switchTab = function(t) { document.querySelectorAll('.view-section').forEach(s=>s.classList.remove('active')); document.querySelectorAll('.nav-item').forEach(i=>i.classList.remove('active')); document.getElementById(t+'View').classList.add('active'); document.getElementById('nav-'+t).classList.add('active'); if(t==='wallet') renderWallet(); if(t==='champ') initLB(); };
    window.openLangModal=()=>{ document.getElementById('modalOverlay').style.display='flex'; const l=document.getElementById('langList'); l.innerHTML=''; LANGUAGES.forEach(x=>{ l.innerHTML+=`<div class="lang-item" onclick="changeLang('${x.code}')">${x.flag} ${x.name}</div>`; }); }
    window.changeLang=(c)=>{ user.lang=c; saveData(); updateAllUI(); document.getElementById('modalOverlay').style.display='none'; }
    window.copyRefLink=()=>{ const c=document.getElementById('myRefLink'); c.select(); document.execCommand('copy'); document.getElementById('copyBtn').innerText='KOPYALANDI!'; setTimeout(()=>document.getElementById('copyBtn').innerText='LÄ°NKÄ° KOPYALA',2000); }
    window.updateHUD=()=>{ const h=document.getElementById('hud-top'); h.innerHTML=''; COINS.forEach(c=>{ h.innerHTML+=`<div class="hud-pill" style="border-color:${c.color}">${c.id}: ${user.balances[c.id].toLocaleString()}</div>`; }); }
    window.goToWalletFromGame=()=>{ document.getElementById('gameOverUI').style.display='none'; document.getElementById('startContainer').style.display='block'; switchTab('wallet'); }
    window.switchLbTab=(t)=>{ document.getElementById('tabDaily').style.background=t==='daily'?'var(--neon-cyan)':'transparent'; document.getElementById('tabRef').style.background=t==='ref'?'var(--neon-cyan)':'transparent'; renderLB(t); }
    window.initLB=()=>{ if(!user.lbData.daily.length){ for(let i=0;i<20;i++){ user.lbData.daily.push({name:'Miner_'+Math.floor(Math.random()*999),score:Math.floor(Math.random()*5000000)}); user.lbData.ref.push({name:'Ref_'+Math.floor(Math.random()*99),score:Math.floor(Math.random()*50)}); } } renderLB('daily'); }
    function renderLB(t){ const l=document.getElementById('rankContainer'); l.innerHTML=''; let d=[...user.lbData[t]]; d.push({name:'YOU',score:t==='daily'?user.balances.USDT:user.referrals.length,me:true}); d.sort((a,b)=>b.score-a.score); d.forEach((x,i)=>{ l.innerHTML+=`<div class="rank-item" style="${x.me?'border:1px solid var(--neon-cyan)':''}"><div style="width:30px;">${i+1}</div><div style="flex:1;">${x.name}</div><div>${x.score.toLocaleString()}</div></div>`; }); }
    function withdraw(id){ if(user.balances[id]>=1000000){ user.balances[id]-=1000000; saveData(); renderWallet(); alert(t('sentMsg')); } }
    function watchAd(){ alert('2X!'); for(let k in sessionEarn) user.balances[k]+=sessionEarn[k]; saveData(); goToWalletFromGame(); }
</script>
</body>
</html>
